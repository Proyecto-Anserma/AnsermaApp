<div class="reportes-container">
  <!-- Menú de navegación mejorado -->
  <nav class="nav-reportes mb-4">
    <ul class="nav nav-tabs nav-fill">
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="tipoReporteActual === 'solicitudes'"
           (click)="cambiarTipoReporte('solicitudes')"
           href="javascript:void(0)">
           <i class="fas fa-file-alt me-2"></i>
           Solicitudes
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="tipoReporteActual === 'ciudadanos'"
           (click)="cambiarTipoReporte('ciudadanos')"
           href="javascript:void(0)">
           <i class="fas fa-users me-2"></i>
           Solicitudes por Ubicación
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" 
           [class.active]="tipoReporteActual === 'ayudas'"
           (click)="cambiarTipoReporte('ayudas')"
           href="javascript:void(0)">
           <i class="fas fa-users me-2"></i>
           Solicitudes por Ciudadano
        </a>
      </li>
    </ul>
  </nav>

  <div class="reportes-header">
    <h2 class="mb-3">{{ tituloReporte }}</h2>
    
    <!-- Contenido del Reporte de Solicitudes -->
    <div *ngIf="mostrarReporteSolicitudes">
      <div class="filtros-container">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Fecha Inicio:</label>
            <input type="date" class="form-control" [(ngModel)]="filtros.fechaInicio">
          </div>
          
          <div class="col-md-3">
            <label class="form-label">Fecha Fin:</label>
            <input type="date" class="form-control" [(ngModel)]="filtros.fechaFin">
          </div>
          
          <div class="col-md-3">
            <label class="form-label">Estado:</label>
            <select class="form-select" [(ngModel)]="filtros.estado">
              <option [ngValue]="null">Todos</option>
              <option *ngFor="let estado of estados" [ngValue]="estado.id" [hidden]="estado.id === ''">
                {{estado.nombre}}
              </option>
            </select>
          </div>
          
          <div class="col-md-3 d-flex align-items-end gap-2">
            <button class="btn btn-primary flex-grow-1" (click)="aplicarFiltros()">
              <i class="fas fa-filter me-2"></i>Aplicar Filtros
            </button>
            <button class="btn btn-secondary" (click)="limpiarFiltros()">
              <i class="fas fa-broom me-2"></i>Limpiar
            </button>
          </div>
        </div>
      </div>
      
      <div class="grafico-container">
        <canvas id="reporteChart" [hidden]="!hayDatos"></canvas>
        <div *ngIf="!hayDatos" class="no-data-message">
          <i class="fas fa-info-circle me-2"></i>
          {{ mensajeNoData }}
        </div>
      </div>
    </div>

    <!-- Contenido del Reporte de Ciudadanos -->
    <div *ngIf="mostrarReporteCiudadanos">
      <!-- Filtros para el mapa -->
      <div class="filtros-container mb-3">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Filtrar por Ubicación:</label>
            <select class="form-select" [(ngModel)]="filtroMapa.ubicacionId">
              <option [ngValue]="null">Todas las ubicaciones</option>
              <option *ngFor="let ubicacion of ubicacionesUnicas" [ngValue]="ubicacion.id_ubicacion">
                {{ ubicacion.descripcion_ubicacion }}
              </option>
            </select>
          </div>
          
          <div class="col-md-4">
            <label class="form-label">Filtrar por Estado:</label>
            <select class="form-select" [(ngModel)]="filtroMapa.estadoId">
              <option [ngValue]="null">Todos los estados</option>
              <option *ngFor="let estado of obtenerEstadosUnicos()" [ngValue]="estado.id_estado">
                {{ estado.descripcion_estado }}
              </option>
            </select>
          </div>
          
          <div class="col-md-4 d-flex align-items-end gap-2">
            <button class="btn btn-primary flex-grow-1" (click)="aplicarFiltrosMapa()">
              <i class="fas fa-filter me-2"></i>Aplicar Filtros
            </button>
            <button class="btn btn-secondary" (click)="limpiarFiltrosMapa()">
              <i class="fas fa-broom me-2"></i>Limpiar
            </button>
          </div>
        </div>
      </div>

      <div class="mapa-container" style="height: 500px; position: relative;">
        <div id="mapaReportes" style="width: 100%; height: 100%;"></div>
        
        <!-- Leyenda del mapa -->
        <div class="mapa-leyenda">
          <h6>Ubicaciones</h6>
          <div class="leyenda-items">
            <div *ngFor="let ubicacion of obtenerUbicacionesFiltradas()" class="leyenda-item">
              <span class="marcador-color" [style.background-color]="obtenerColorUbicacion(ubicacion.id_ubicacion)"></span>
              <span class="ubicacion-nombre">{{ ubicacion.descripcion_ubicacion }}</span>
              <span class="ubicacion-cantidad">({{ contarSolicitudesPorUbicacion(ubicacion.id_ubicacion) }})</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contenido del Reporte de Ayudas -->
    <div *ngIf="mostrarReporteAyudas">
      <div class="filtros-container mb-3">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Filtrar por Ciudadano:</label>
            <select class="form-select" [(ngModel)]="filtroMapa.ubicacionId">
              <option [ngValue]="null">Todos los ciudadanos</option>
              <option *ngFor="let ciudadano of obtenerCiudadanosUnicos()" [ngValue]="ciudadano">
                {{ ciudadano }}
              </option>
            </select>
          </div>
          
          <div class="col-md-4">
            <label class="form-label">Filtrar por Estado:</label>
            <select class="form-select" [(ngModel)]="filtroMapa.estadoId">
              <option [ngValue]="null">Todos los estados</option>
              <option *ngFor="let estado of obtenerEstadosUnicos()" [ngValue]="estado.id_estado">
                {{ estado.descripcion_estado }}
              </option>
            </select>
          </div>
          
          <div class="col-md-4 d-flex align-items-end gap-2">
            <button class="btn btn-primary flex-grow-1" (click)="aplicarFiltrosMapa()">
              <i class="fas fa-filter me-2"></i>Aplicar Filtros
            </button>
            <button class="btn btn-secondary" (click)="limpiarFiltrosMapa()">
              <i class="fas fa-broom me-2"></i>Limpiar
            </button>
          </div>
        </div>
      </div>

      <div class="mapa-container" style="height: 500px; position: relative;">
        <div id="mapaReportes" style="width: 100%; height: 100%;"></div>
        
        <!-- Leyenda del mapa -->
        <div class="mapa-leyenda">
          <h6>Ciudadanos</h6>
          <div class="leyenda-items">
            <div *ngFor="let ciudadano of obtenerCiudadanosFiltrados()" class="leyenda-item">
              <span class="marcador-color" [style.background-color]="obtenerColorCiudadano(ciudadano)"></span>
              <span class="ubicacion-nombre">Ciudadano {{ ciudadano }}</span>
              <span class="ubicacion-cantidad">({{ contarSolicitudesPorCiudadano(ciudadano) }})</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 